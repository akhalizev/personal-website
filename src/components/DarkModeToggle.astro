---
// Simple client-side toggle button
---

<button
  id="theme-toggle"
  type="button"
  aria-label="Toggle dark mode"
  class="fixed bottom-4 right-4 z-50 inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/70 dark:bg-macos-gray-800/70 backdrop-blur-md shadow-macos border border-macos-gray-200/70 dark:border-macos-gray-700/70 hover:bg-white dark:hover:bg-macos-gray-800 transition-colors"
>
  <!-- Sun icon -->
  <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5 text-macos-yellow-600 hidden">
    <path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zm10.45 14.32l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM12 4V1h-1v3h1zm0 19v-3h-1v3h1zM4 13H1v-1h3v1zm19 0h-3v-1h3v1zM6.76 19.16l-1.42 1.42-1.79-1.8 1.41-1.41 1.8 1.79zM18.36 4.22l1.8-1.79 1.41 1.41-1.79 1.8-1.42-1.42z"/>
    <circle cx="11.5" cy="11.5" r="4.5" />
  </svg>
  <!-- Moon icon -->
  <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5 text-macos-blue-500 hidden">
    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
  </svg>
</button>

<script is:inline>
  (function () {
    const btn = document.getElementById('theme-toggle');
    if (!btn) return;

    const html = document.documentElement;
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');

    function updateUI() {
      const isDark = html.classList.contains('dark');
      if (sunIcon && moonIcon) {
        // Show sun in light mode (to indicate switching to dark), show moon in dark mode (to indicate switching to light)
        sunIcon.classList.toggle('hidden', isDark);
        moonIcon.classList.toggle('hidden', !isDark);
      }
      btn.setAttribute('aria-pressed', String(isDark));
      btn.title = isDark ? 'Switch to light mode' : 'Switch to dark mode';
    }

    // Initialize icons/state to match current theme (set early in <head>)
    updateUI();

    btn.addEventListener('click', () => {
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateUI();
    });

    // Also react to system preference changes if user hasn't explicitly chosen
    const media = window.matchMedia('(prefers-color-scheme: dark)');
    media.addEventListener?.('change', (e) => {
      const saved = localStorage.getItem('theme');
      if (saved) return; // Respect explicit choice
      if (e.matches) html.classList.add('dark');
      else html.classList.remove('dark');
      updateUI();
    });
  })();
</script>
